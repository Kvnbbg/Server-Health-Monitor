<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Server Health Monitor — CRUD SOLID Architecture</title>
    <style>
        /* Design Tokens — DRY Variable System */
        :root {
            --color-bg: #f5f5f7;
            --color-surface: #ffffff;
            --color-text: #1d1d1f;
            --color-text-sec: #86868b;
            --color-border: #d2d2d7;
            --color-accent: #0071e3;      /* Accessible Blue */
            --color-success: #34c759;     /* System Green */
            --color-warning: #ff9500;     /* System Orange */
            --color-danger: #ff3b30;      /* System Red */
            
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            
            --header-height: 56px;
            --footer-height: 64px;
            --nav-width: 280px;
            --panel-width: 320px;
            
            --touch-min: 44px; /* Mobile Accessibility */
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #000000;
                --color-surface: #1c1c1e;
                --color-text: #ffffff;
                --color-text-sec: #8e8e93;
                --color-border: #38383a;
            }
        }

        /* Reset & Base — DRY */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.47059;
            -webkit-text-size-adjust: 100%;
        }

        body {
            background: var(--color-bg);
            color: var(--color-text);
            height: 100vh;
            height: 100dvh; /* Mobile viewport fix */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Typography Scale — DRY */
        .text-xs { font-size: 0.75rem; line-height: 1.33337; letter-spacing: -0.01em; }
        .text-sm { font-size: 0.875rem; line-height: 1.42859; letter-spacing: -0.016em; }
        .text-base { font-size: 1rem; line-height: 1.5; letter-spacing: -0.02em; }
        .text-lg { font-size: 1.25rem; line-height: 1.2; letter-spacing: -0.02em; }
        .text-xl { font-size: 1.5rem; line-height: 1.16667; letter-spacing: -0.02em; }

        /* Layout Architecture — SOLID: Single Responsibility per Region */
        .app-shell {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100%;
            overflow: hidden;
        }

        /* Header — Fixed, Status Only */
        .app-header {
            height: var(--header-height);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-md);
            position: relative;
            z-index: 100;
        }

        @supports not (backdrop-filter: blur(20px)) {
            .app-header { background: var(--color-surface); }
        }

        /* Main Workspace — Responsive Grid */
        .app-workspace {
            display: grid;
            grid-template-columns: 1fr; /* Mobile: Single column */
            grid-template-rows: auto 1fr;
            overflow: hidden;
            position: relative;
        }

        @media (min-width: 1024px) {
            .app-workspace {
                grid-template-columns: var(--nav-width) 1fr var(--panel-width);
                grid-template-rows: 1fr;
            }
        }

        /* Navigation — Mobile: Bottom Bar, Desktop: Sidebar */
        .app-nav {
            display: none; /* Mobile default */
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
            order: 3;
        }

        @media (max-width: 1023px) {
            .app-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: var(--footer-height);
                justify-content: space-around;
                align-items: center;
                padding-bottom: env(safe-area-inset-bottom);
                z-index: 90;
            }
            
            .app-nav .nav-item {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                gap: 4px;
                cursor: pointer;
                color: var(--color-text-sec);
                transition: color 0.2s;
            }
            
            .app-nav .nav-item.active {
                color: var(--color-accent);
            }
            
            .app-nav .nav-icon {
                font-size: 24px;
                height: 24px;
            }
            
            .app-nav .nav-label {
                font-size: 10px;
                font-weight: 600;
            }
        }

        @media (min-width: 1024px) {
            .app-nav {
                display: block;
                border-right: 1px solid var(--color-border);
                border-top: none;
                overflow-y: auto;
                padding: var(--space-md) 0;
            }
            
            .app-nav .nav-item {
                display: flex;
                align-items: center;
                gap: var(--space-md);
                padding: var(--space-md) var(--space-lg);
                margin: 0 var(--space-sm);
                border-radius: var(--radius-md);
                cursor: pointer;
                color: var(--color-text-sec);
                transition: all 0.15s;
                height: var(--touch-min);
            }
            
            .app-nav .nav-item:hover {
                background: rgba(0, 113, 227, 0.05);
                color: var(--color-text);
            }
            
            .app-nav .nav-item.active {
                background: rgba(0, 113, 227, 0.1);
                color: var(--color-accent);
                font-weight: 600;
            }
        }

        /* Content Area — CRUD Interface */
        .app-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-bottom: var(--footer-height); /* Mobile nav spacing */
        }

        @media (min-width: 1024px) {
            .app-content {
                padding-bottom: 0;
            }
        }

        /* SMART Toolbar — Specific Controls */
        .control-bar {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        @media (min-width: 640px) {
            .control-bar {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .control-group {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        /* Button Component — DRY */
        .btn {
            height: var(--touch-min);
            padding: 0 var(--space-lg);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            white-space: nowrap;
            min-width: var(--touch-min);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--color-accent);
            color: white;
        }

        .btn-primary:active { background: #0051a2; }

        .btn-secondary {
            background: var(--color-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:active { background: var(--color-border); }

        .btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-icon {
            width: var(--touch-min);
            height: var(--touch-min);
            padding: 0;
            border-radius: 50%;
        }

        /* Form Elements — DRY */
        .input, .select {
            height: var(--touch-min);
            padding: 0 var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px; /* Prevent zoom on iOS */
            background: var(--color-surface);
            color: var(--color-text);
            min-width: 120px;
        }

        .input:focus, .select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15);
        }

        /* Data Grid — CRUD Operations Surface */
        .data-container {
            flex: 1;
            overflow: auto;
            padding: var(--space-md);
            -webkit-overflow-scrolling: touch;
        }

        .crud-grid {
            width: 100%;
            background: var(--color-surface);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            overflow: hidden;
            min-width: 640px; /* Horizontal scroll on mobile if needed */
        }

        .grid-header {
            display: grid;
            grid-template-columns: 80px 1fr 100px 100px 140px;
            background: rgba(0, 0, 0, 0.02);
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .grid-cell {
            padding: var(--space-md);
            font-size: 14px;
            display: flex;
            align-items: center;
            border-right: 1px solid var(--color-border);
        }

        .grid-cell:last-child { border-right: none; }

        .grid-header .grid-cell {
            font-weight: 700;
            color: var(--color-text-sec);
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.05em;
        }

        .grid-body {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }

        .grid-row {
            display: grid;
            grid-template-columns: 80px 1fr 100px 100px 140px;
            border-bottom: 1px solid var(--color-border);
            transition: background 0.15s;
            cursor: pointer;
        }

        .grid-row:hover { background: rgba(0, 113, 227, 0.03); }
        .grid-row.selected { background: rgba(0, 113, 227, 0.08); }

        .grid-row .grid-cell {
            border-right: 1px solid var(--color-border);
        }

        /* Status Badges — DRY */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .badge-normal { background: rgba(52, 199, 89, 0.15); color: #1d7e35; }
        .badge-warning { background: rgba(255, 149, 0, 0.15); color: #b37400; }
        .badge-critical { background: rgba(255, 59, 48, 0.15); color: #c41c15; }

        /* Lucide Icon System */
        .lucide-icon {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            flex-shrink: 0;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .icon-pulse {
            animation: iconPulse 2.4s ease-in-out infinite;
            transform-origin: center;
        }

        .icon-spin-hover:hover .lucide-icon {
            transform: rotate(20deg) scale(1.08);
        }

        .nav-item.active .lucide-icon {
            animation: iconFloat 2.2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.08); opacity: 1; }
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* Detail Panel — Desktop Only */
        .app-details {
            display: none;
            background: var(--color-surface);
            border-left: 1px solid var(--color-border);
            flex-direction: column;
        }

        @media (min-width: 1024px) {
            .app-details { display: flex; }
        }

        .detail-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--color-border);
            font-weight: 700;
        }

        .detail-body {
            padding: var(--space-lg);
            overflow-y: auto;
        }

        .detail-field {
            margin-bottom: var(--space-lg);
        }

        .detail-label {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--color-text-sec);
            font-weight: 700;
            margin-bottom: var(--space-xs);
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-family: "SF Mono", SFMono-Regular, monospace;
            font-size: 15px;
            word-break: break-all;
        }

        /* Mobile Modal for Details */
        @media (max-width: 1023px) {
            .mobile-modal {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 200;
                display: none;
                align-items: flex-end;
                backdrop-filter: blur(10px);
            }
            
            .mobile-modal.active { display: flex; }
            
            .modal-sheet {
                background: var(--color-surface);
                width: 100%;
                max-height: 80vh;
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                padding: var(--space-xl) var(--space-lg);
                animation: slideUp 0.3s ease;
                overflow-y: auto;
            }
            
            @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
            }
        }

        /* Floating Action Button — Mobile CRUD Create */
        .fab {
            position: fixed;
            right: var(--space-lg);
            bottom: calc(var(--footer-height) + var(--space-lg));
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--color-accent);
            color: white;
            border: none;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.4);
            cursor: pointer;
            z-index: 80;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 1024px) {
            .fab { display: none; }
        }

        /* Pagination — DRY */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
        }

        .page-info {
            font-size: 14px;
            color: var(--color-text-sec);
            font-weight: 600;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .sr-only { position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden; }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <!-- Header — Global Status (Single Responsibility) -->
        <header class="app-header">
            <div style="display: flex; align-items: center; gap: var(--space-md);">
                <div style="font-weight: 700; font-size: 20px; letter-spacing: -0.5px;">SHM</div>
                <div style="width: 1px; height: 24px; background: var(--color-border);"></div>
                <div style="font-size: 14px; color: var(--color-text-sec); font-weight: 600;">
                    <span id="conn-status" style="color: var(--color-success);">●</span> Connected
                </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: var(--space-sm);">
                <span class="text-sm" style="color: var(--color-text-sec); font-weight: 600;" id="record-count">0 records</span>
                <button class="btn btn-icon btn-secondary icon-spin-hover" onclick="refreshData()" aria-label="Refresh">
                    <svg class="lucide-icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M21 12a9 9 0 1 1-2.64-6.36"/>
                        <polyline points="22 3 21 12 12 11"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Workspace -->
        <div class="app-workspace">
            <!-- Navigation — Interface Segregation (different mobile/desktop) -->
            <nav class="app-nav" role="navigation" aria-label="Main navigation">
                <div class="nav-item active" onclick="setTool('monitor', this)" role="button" tabindex="0">
                    <span class="nav-icon">
                        <svg class="lucide-icon icon-pulse" viewBox="0 0 24 24" aria-hidden="true">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                    </span>
                    <span class="nav-label">Monitor</span>
                </div>
                <div class="nav-item" onclick="setTool('documents', this)" role="button" tabindex="0">
                    <span class="nav-icon">
                        <svg class="lucide-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <line x1="10" y1="9" x2="8" y2="9"/>
                        </svg>
                    </span>
                    <span class="nav-label">Docs</span>
                </div>
                <div class="nav-item" onclick="setTool('agents', this)" role="button" tabindex="0">
                    <span class="nav-icon">
                        <svg class="lucide-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <rect x="3" y="11" width="18" height="10" rx="2"/>
                            <circle cx="7" cy="16" r="1"/>
                            <circle cx="17" cy="16" r="1"/>
                            <path d="M12 11V7"/>
                            <path d="M9 7h6"/>
                        </svg>
                    </span>
                    <span class="nav-label">Agents</span>
                </div>
                <div class="nav-item" onclick="setTool('settings', this)" role="button" tabindex="0">
                    <span class="nav-icon">
                        <svg class="lucide-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.26 1.3.73 1.77.47.47 1.1.73 1.77.73H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </span>
                    <span class="nav-label">Settings</span>
                </div>
            </nav>

            <!-- Content Area — CRUD Operations -->
            <main class="app-content">
                <!-- Control Bar — SMART: Specific, Measurable controls -->
                <div class="control-bar">
                    <div class="control-group">
                        <select class="select" id="server-select" onchange="updateServer(this.value)">
                            <option value="localhost">localhost</option>
                            <option value="prod-01">prod-01</option>
                            <option value="prod-02">prod-02</option>
                        </select>
                        
                        <select class="select" id="interval-select" onchange="updateInterval(this.value)">
                            <option value="1000">1s interval</option>
                            <option value="5000" selected>5s interval</option>
                            <option value="30000">30s interval</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <button class="btn btn-secondary" onclick="exportData()">Export CSV</button>
                        <button class="btn btn-primary" id="btn-toggle" onclick="toggleMonitoring()">Start</button>
                    </div>
                </div>

                <!-- Data Grid — CRUD Read Interface -->
                <div class="data-container">
                    <div class="crud-grid">
                        <div class="grid-header">
                            <div class="grid-cell">ID</div>
                            <div class="grid-cell">Timestamp</div>
                            <div class="grid-cell">CPU</div>
                            <div class="grid-cell">Status</div>
                            <div class="grid-cell">Actions</div>
                        </div>
                        <div class="grid-body" id="grid-body">
                            <!-- Rows injected by JS -->
                        </div>
                    </div>
                    
                    <!-- Pagination — No infinite scroll -->
                    <div class="pagination">
                        <button class="btn btn-secondary" onclick="changePage(-1)" id="btn-prev">Previous</button>
                        <span class="page-info">Page <span id="page-current">1</span> of <span id="page-total">1</span></span>
                        <button class="btn btn-secondary" onclick="changePage(1)" id="btn-next">Next</button>
                    </div>
                </div>
            </main>

            <!-- Detail Panel — CRUD Update/Delete Interface -->
            <aside class="app-details" id="detail-panel">
                <div class="detail-header">Record Details</div>
                <div class="detail-body" id="detail-content">
                    <p style="color: var(--color-text-sec); text-align: center; margin-top: 40px;">Select a record to view details</p>
                </div>
            </aside>
        </div>
    </div>

    <!-- Mobile FAB — CRUD Create -->
    <button class="fab" onclick="createRecord()" aria-label="Add new record">
        <svg class="lucide-icon" viewBox="0 0 24 24" aria-hidden="true">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
    </button>

    <!-- Mobile Detail Modal -->
    <div class="mobile-modal" id="mobile-modal" onclick="closeModal(event)">
        <div class="modal-sheet" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
                <h3 style="font-size: 20px; font-weight: 700;">Record Details</h3>
                <button class="btn btn-icon btn-secondary" onclick="closeModal()" style="width: 32px; height: 32px;">✕</button>
            </div>
            <div id="mobile-detail-content"></div>
        </div>
    </div>

    <script>
        /**
         * Architecture: SOLID Principles
         * S: StateManager handles state exclusively
         * O: Extensible via Tool strategies
         * L: Consistent interface across viewports
         * I: Segregated mobile/desktop renderers
         * D: Dependencies injected via config
         */

        // Single Responsibility: State Management
        const StateManager = {
            data: [],
            config: {
                maxRecords: 1000,
                pageSize: 10,
                currentPage: 1,
                isMonitoring: false,
                interval: null,
                server: 'localhost',
                sampleRate: 5000
            },
            
            // CRUD: Create
            create(metric) {
                const record = {
                    id: Date.now().toString(36).toUpperCase(),
                    timestamp: new Date().toISOString(),
                    server: this.config.server,
                    ...metric
                };
                
                this.data.unshift(record);
                
                // Boundary enforcement (SMART: Time-bound/Measurable)
                if (this.data.length > this.config.maxRecords) {
                    this.data.pop();
                }
                
                return record;
            },
            
            // CRUD: Read (with pagination)
            read(page = this.config.currentPage) {
                const start = (page - 1) * this.config.pageSize;
                return this.data.slice(start, start + this.config.pageSize);
            },
            
            // CRUD: Update
            update(id, changes) {
                const idx = this.data.findIndex(r => r.id === id);
                if (idx !== -1) {
                    this.data[idx] = { ...this.data[idx], ...changes };
                    return this.data[idx];
                }
                return null;
            },
            
            // CRUD: Delete
            delete(id) {
                const idx = this.data.findIndex(r => r.id === id);
                if (idx !== -1) {
                    return this.data.splice(idx, 1)[0];
                }
                return null;
            },
            
            get totalPages() {
                return Math.ceil(this.data.length / this.config.pageSize) || 1;
            }
        };

        // Interface Segregation: View Controller
        const ViewController = {
            renderGrid() {
                const tbody = document.getElementById('grid-body');
                const records = StateManager.read();
                
                tbody.innerHTML = records.map(record => this.renderRow(record)).join('');
                
                // Update pagination
                document.getElementById('page-current').textContent = StateManager.config.currentPage;
                document.getElementById('page-total').textContent = StateManager.totalPages;
                document.getElementById('btn-prev').disabled = StateManager.config.currentPage === 1;
                document.getElementById('btn-next').disabled = StateManager.config.currentPage >= StateManager.totalPages;
                document.getElementById('record-count').textContent = `${StateManager.data.length} records`;
            },
            
            renderRow(record) {
                const statusClass = record.cpu > 80 ? 'badge-critical' : record.cpu > 60 ? 'badge-warning' : 'badge-normal';
                const statusText = record.cpu > 80 ? 'Critical' : record.cpu > 60 ? 'Warning' : 'Normal';
                
                return `
                    <div class="grid-row" onclick="selectRecord('${record.id}')">
                        <div class="grid-cell" style="font-family: monospace; font-size: 13px;">#${record.id.slice(-4)}</div>
                        <div class="grid-cell" style="font-size: 13px; color: var(--color-text-sec);">${new Date(record.timestamp).toLocaleTimeString()}</div>
                        <div class="grid-cell" style="font-weight: 600;">${record.cpu}%</div>
                        <div class="grid-cell"><span class="badge ${statusClass}">${statusText}</span></div>
                        <div class="grid-cell" style="gap: 8px;">
                            <button class="btn btn-secondary" style="padding: 0 12px; height: 32px; font-size: 13px;" onclick="event.stopPropagation(); editRecord('${record.id}')">Edit</button>
                            <button class="btn btn-danger" style="padding: 0 12px; height: 32px; font-size: 13px;" onclick="event.stopPropagation(); deleteRecord('${record.id}')">Del</button>
                        </div>
                    </div>
                `;
            },
            
            renderDetail(record) {
                const html = `
                    <div class="detail-field">
                        <div class="detail-label">Record ID</div>
                        <div class="detail-value">${record.id}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Server</div>
                        <div class="detail-value">${record.server}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Timestamp</div>
                        <div class="detail-value">${record.timestamp}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">CPU Usage</div>
                        <div class="detail-value" style="color: ${record.cpu > 80 ? 'var(--color-danger)' : 'inherit'}">${record.cpu}%</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Memory</div>
                        <div class="detail-value">${record.ram || '--'}%</div>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 32px;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="closeModal()">Close</button>
                        <button class="btn btn-danger" style="flex: 1;" onclick="deleteRecord('${record.id}')">Delete</button>
                    </div>
                `;
                
                // Dependency Inversion: Different render targets
                if (window.innerWidth >= 1024) {
                    document.getElementById('detail-content').innerHTML = html;
                } else {
                    document.getElementById('mobile-detail-content').innerHTML = html;
                    document.getElementById('mobile-modal').classList.add('active');
                }
            }
        };

        // Control Logic — DRY
        function toggleMonitoring() {
            const btn = document.getElementById('btn-toggle');
            StateManager.config.isMonitoring = !StateManager.config.isMonitoring;
            
            if (StateManager.config.isMonitoring) {
                btn.textContent = 'Stop';
                btn.classList.replace('btn-primary', 'btn-danger');
                tick();
                StateManager.config.interval = setInterval(tick, StateManager.config.sampleRate);
            } else {
                btn.textContent = 'Start';
                btn.classList.replace('btn-danger', 'btn-primary');
                clearInterval(StateManager.config.interval);
            }
        }

        function tick() {
            // Measurable, Specific data generation
            StateManager.create({
                cpu: (Math.random() * 40 + 10).toFixed(1),
                ram: (Math.random() * 30 + 40).toFixed(1)
            });
            ViewController.renderGrid();
        }

        function changePage(dir) {
            StateManager.config.currentPage += dir;
            ViewController.renderGrid();
        }

        function selectRecord(id) {
            const record = StateManager.data.find(r => r.id === id);
            if (record) ViewController.renderDetail(record);
        }

        function editRecord(id) {
            const record = StateManager.update(id, { cpu: (Math.random() * 100).toFixed(1) });
            if (record) ViewController.renderGrid();
        }

        function deleteRecord(id) {
            if (confirm('Delete this record?')) {
                StateManager.delete(id);
                ViewController.renderGrid();
                closeModal();
            }
        }

        function createRecord() {
            // FAB action: Create sample
            tick();
            // Scroll to top
            document.querySelector('.data-container').scrollTop = 0;
        }

        function updateServer(val) {
            StateManager.config.server = val;
        }

        function updateInterval(val) {
            StateManager.config.sampleRate = parseInt(val);
            if (StateManager.config.isMonitoring) {
                clearInterval(StateManager.config.interval);
                StateManager.config.interval = setInterval(tick, StateManager.config.sampleRate);
            }
        }

        function exportData() {
            const csv = StateManager.data.map(r => `${r.id},${r.timestamp},${r.cpu},${r.ram}`).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `server-metrics-${Date.now()}.csv`;
            a.click();
        }

        function refreshData() {
            ViewController.renderGrid();
        }

        function setTool(tool, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            // Tool switching logic here (Open/Closed extension point)
        }

        function closeModal(e) {
            if (!e || e.target.id === 'mobile-modal') {
                document.getElementById('mobile-modal').classList.remove('active');
            }
        }

        // Initialize with sample data
        for (let i = 0; i < 25; i++) {
            StateManager.create({
                cpu: (Math.random() * 35 + 15).toFixed(1),
                ram: (Math.random() * 25 + 45).toFixed(1)
            });
        }
        ViewController.renderGrid();
    </script>
</body>
</html>
